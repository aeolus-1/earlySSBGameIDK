<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>drawer</title>
    <script src="libs/peer.js"></script>
    <script src="libs/matter.js"></script>
    <script src="libs/decomp.js"></script>
    <script src="libs/common.js"></script>
    <script src="libs/resurrect.js"></script>
    <style>
      body {
        margin: 0%;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <script src="matterInit.js"></script>
    <img src="m16.png" id="gun">
    <script>
      var spawnPoints = [v(855.8181670104865,1522.0270814533455),v(2247.554572466912,940.9677959175898),v(967.6447812937414,367.2323634734135),v(2307.4936882779007,349.29906655323293),v(3478.786842405824,343.7395804083279),v(3472.383292059527,1143.6681164373022),v(2347.5319305552416,1542.0470304068654),v(2704.750694938356,1990.8464481503904)]

var enemeyPreKeys = {}
    setInterval(() => {
      if (keys["enter"]&&!player.alive) {
        respawn()
      }
        player.update(keys, prekeys)
        
        for (let i = 0; i < enemeyPlayers.length; i++) {
          const player = enemeyPlayers[i];
          player.update()
        }
        for (let i = 0; i < hostConnections.length; i++) {
          const conn = hostConnections[i];
          if (conn.online) {
            //conn.sendClientDataBack()
          }
        }
        player.bleeding = player.stats.health <= 0.4
        
        updateClients()
        if (window.clientConnection!=undefined) if (joining!=undefined) {
          console.log(window.clientConnection.conn._open)
          window.clientConnection.updateHost()
        }

        telepoter.update()
        
        enemeyPreKeys = {...window.enemeyKeys}
        Engine.update(engine, Math.min((new Date()).getTime()-preTimeDelta, 50))
        particleController.runParticles()
        preTimeDelta = (new Date()).getTime()
        runBullets()
        prekeys = {...keys}

    }, 1000/60);

function addBody(bod) {
            Matter.Composite.add(engine.world, bod)
            return bod
        }

        
        var keys = {shift:false},
            prekeys = {shift:false}
        document.addEventListener("keydown", (e)=>{
            keys[e.key.toLowerCase()] = true
        })
        document.addEventListener("keyup", (e)=>{
            keys[e.key.toLowerCase()] = false
        })
        
    </script>
    <script src="camera.js"></script>
    <script src="log.js"></script>

    <script src="teleporters.js"></script>

    <script src="playerController.js"></script>
    <script src="particles.js"></script>
    <script src="multiplayer.js"></script>

<script>
    const particleController = new ParticleController(engine)
    var player = new PlayerController(engine,{
        body:{
            scale:15,
            density:0.01,
        },

        speed:0.6,

        keys:keys,
        preKeys:prekeys,
        username:username,
    })



    var telepoter = new Teleporter(v(300,100), v(3700,1471))

    Matter.Composite.allBodies(engine.world).forEach(b=>{if(b.platform){b.collisionFilter.group = 45678903;b.render.fillStyle = "#eee"}})
    

    function respawn() {
      player.options.speed = 0.6
      player.options.jumpHeight = 1
      player.alive = true
      player.stats.health = 1
      player.stabilsing = true
      var point = {...spawnPoints[randInt(0,spawnPoints.length-1)]}
      console.log(point)
      Matter.Body.setPosition(player.body,point)
    }
    
</script>
<div style="position:absolute;z-index:100;top:0px;"><a href="index.html">Main Menu</a><br><button id="addClientBut">+ Client</button><div id="idDiv" ></div></div>


  </body>
</html>